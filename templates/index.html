<!DOCTYPE html>
<html>
<head>
    <title>NPC Gachapon</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="static/styles.css">
    <!-- Bootstrap JS, Popper.js, and jQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</head>    
<body>
    <div class="container my-4">
        <h1 class="display-4 text-center mb-4 font-weight-bold">NPC Gachapon</h1>

         <!-- GACHAPON SETTINGS -->
         <div id="gachapon-settings">
            <h5>Gachapon Machine Settings</h5>
            <div class="card mt-3 mb-3">
                <div class="row">
                    <div class="col-auto">
                        <label for="checkbox-first-initial" class="checbox-label">First Initial</label>
                        <input type="checkbox" id="checkbox-first-initial" name="checkbox-first-initial" checked>
                    </div>
                    <div class="col-auto">
                        <label for="checkbox-last-initial" class="checbox-label">Last Initial</label>
                        <input type="checkbox" id="checkbox-last-initial" name="checkbox-last-initial" checked>
                    </div>
                    <div class="col-auto">
                        <label for="checkbox-alignment" class="checbox-label">Alignment</label>
                        <input type="checkbox" id="checkbox-alignment" name="checkbox-alignment" checked>
                    </div>
                    <div class="col-auto">
                        <label for="checkbox-race" class="checbox-label">Race</label>
                        <input type="checkbox" id="checkbox-race" name="checkbox-race" checked>
                    </div>
                    <div class="col-auto">
                        <label for="checkbox-class" class="checbox-label">Class</label>
                        <input type="checkbox" id="checkbox-class" name="checkbox-class" checked>
                    </div>
                </div>
                <button type="submit"
                        name="generate-attributes"
                        id="button-generate-character" 
                        value="generate-character" 
                        class="btn btn-primary btn-sm my-3">
                        Generate Character
                </button>
            </div>
            <h5>Character Sheet</h5>
            <div class="card mt-3 mb-3">
                <div class="card-body">
                    <p><span class="font-weight-bold clickable-text" onclick="rerollAttribute('first-initial')">First Name:</span> <span id="first-initial"></span></p>
                    <p><span class="font-weight-bold clickable-text" onclick="rerollAttribute('last-initial')">Last Name:</span> <span id="last-initial"></span></p>
                    <p><span class="font-weight-bold clickable-text" onclick="rerollAttribute('alignment')">Alignment:</span> <span id="alignment"></span></p>
                    <p><span class="font-weight-bold clickable-text" onclick="rerollAttribute('race')">Race:</span> <span id="race"></span></p>
                    <p><span class="font-weight-bold clickable-text" onclick="rerollAttribute('class')">Class:</span> <span id="class"></span></p>
                </div>
            </div>
    </div>

    <script>
        // GENERATE CHARACTER BUTTON
        var buttonGenerateCharacter = document.getElementById('button-generate-character')
        buttonGenerateCharacter.addEventListener('click', sendSettings);

        function sendSettings() {

            // Get checkbox states
            var firstInitialChecked = document.getElementById('checkbox-first-initial').checked;
            var lastInitialChecked = document.getElementById('checkbox-last-initial').checked;
            var alignmentChecked = document.getElementById('checkbox-alignment').checked;
            var raceChecked = document.getElementById('checkbox-race').checked;
            var classChecked = document.getElementById('checkbox-class').checked;
            
            // Send AJAX request to Flask backend
            fetch('/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    firstInitialChecked: firstInitialChecked,
                    lastInitialChecked: lastInitialChecked,
                    alignmentChecked: alignmentChecked,
                    raceChecked: raceChecked,
                    classChecked: classChecked
                })
            })
            .then(response => response.json())
            .then(data => {
                // Update the webpage with the generated initials
                document.getElementById('first-initial').textContent = data.first_initial;
                document.getElementById('last-initial').textContent = data.last_initial;
                document.getElementById('alignment').textContent = data.alignment;
                document.getElementById('race').textContent = data.race;
                document.getElementById('class').textContent = data.class;
            })
            .catch(error => {
                console.error('Error:', error);
            });
        };

        // REROLL ATTRIBUTES
        function rerollAttribute(attributeName){
            
            console.log("Reroll attribute.");

            // Send AJAX request to Flask backend
            fetch('/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    'reroll-attribute': attributeName
                })
            })
            .then(response => response.json())
            .then(data => {
                // Update the webpage with the generated initials
                document.getElementById('first-initial').textContent = data.first_initial;
                document.getElementById('last-initial').textContent = data.last_initial;
                document.getElementById('alignment').textContent = data.alignment;
                document.getElementById('race').textContent = data.race;
                document.getElementById('class').textContent = data.class;
            })
            .catch(error => {
                console.error('Error:', error);
            });

        }
    </script>
</body>